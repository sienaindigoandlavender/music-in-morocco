---
import Base from '../../layouts/Base.astro';
import { getThemes } from '../../lib/supabase';

const themes = await getThemes();
const categories = [...new Set(themes.map(t => t.category))].sort();
---

<Base title="Themes — Music in Morocco" description="Thematic concepts in Moroccan performance traditions — trance, healing, identity, celebration, and more.">
  <div class="section-inner">
    <div class="page-header">
      <span class="micro-label">Themes</span>
      <h1>Thematic Index</h1>
      <p class="page-desc">{themes.length} thematic concepts across Moroccan performance traditions.</p>
    </div>

    {categories.map(cat => {
      const group = themes.filter(t => t.category === cat);
      return (
        <section class="cat-section">
          <h2 class="cat-title">{cat}</h2>
          <div class="theme-list">
            {group.map(t => (
              <a href={`/themes/${t.slug}`} class="theme-row">
                <div class="t-main">
                  <span class="t-name">{t.name}</span>
                  {t.name_ar && <span class="t-ar">{t.name_ar}</span>}
                </div>
                <span class="t-desc">{t.description?.slice(0, 120)}…</span>
              </a>
            ))}
          </div>
        </section>
      );
    })}
  </div>
</Base>

<style>
  .cat-section { margin-bottom: var(--space-md); }
  .cat-title { font-size: 0.6rem; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase; color: var(--color-ink-muted); padding-bottom: 0.4rem; border-bottom: 2px solid var(--color-ink); }
  .theme-list { display: flex; flex-direction: column; }
  .theme-row { display: grid; grid-template-columns: 220px 1fr; gap: 1rem; padding: 0.6rem 0; border-bottom: 1px solid var(--color-border); align-items: baseline; transition: padding-left 0.15s; }
  .theme-row:hover { padding-left: 0.4rem; }
  .t-main { display: flex; align-items: baseline; gap: 0.5rem; }
  .t-name { font-family: var(--font-display); font-size: 1.05rem; }
  .t-ar { font-size: 0.8rem; color: var(--color-ink-muted); direction: rtl; }
  .t-desc { font-size: 0.72rem; font-weight: 300; color: var(--color-ink-light); }
  @media (max-width: 640px) { .theme-row { grid-template-columns: 1fr; gap: 0.15rem; } }
</style>
