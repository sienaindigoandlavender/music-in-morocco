---
import Base from '../../layouts/Base.astro';
import { getForms } from '../../lib/supabase';

const forms = await getForms();
const categories = [...new Set(forms.map(f => f.category))].sort();
---

<Base title="Performance Traditions — Music in Morocco" description={`${forms.length} Moroccan performance traditions — Gnawa, Ahwach, Ahidous, Andalusi, Aita, Malhun, and more.`}>
  <div class="section-inner">
    <div class="page-header">
      <span class="micro-label">Traditions</span>
      <h1>Performance Forms</h1>
      <p class="page-desc">{forms.length} documented traditions across Morocco's musical landscape.</p>
    </div>

    {categories.map(cat => {
      const group = forms.filter(f => f.category === cat);
      return (
        <section class="cat-section">
          <h2 class="cat-title">{cat}</h2>
          <div class="form-list">
            {group.map(form => (
              <a href={`/forms/${form.slug}`} class="form-row">
                <div class="fr-main">
                  <span class="fr-name">{form.name}</span>
                  {form.name_ar && <span class="fr-ar">{form.name_ar}</span>}
                </div>
                <span class="fr-region">{form.origin_region}</span>
                <span class="fr-desc">{form.description?.slice(0, 90)}…</span>
                {form.unesco_status && <span class="fr-badge">★ UNESCO</span>}
              </a>
            ))}
          </div>
        </section>
      );
    })}
  </div>
</Base>

<style>
  .cat-section { margin-bottom: var(--space-md); }
  .cat-title { font-size: 0.6rem; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase; color: var(--color-ink-muted); padding-bottom: 0.4rem; border-bottom: 2px solid var(--color-ink); margin-bottom: 0; }
  .form-list { display: flex; flex-direction: column; }
  .form-row { display: grid; grid-template-columns: 200px 140px 1fr auto; gap: 1rem; padding: 0.6rem 0; border-bottom: 1px solid var(--color-border); align-items: baseline; transition: padding-left 0.15s; }
  .form-row:hover { padding-left: 0.4rem; }
  .fr-main { display: flex; align-items: baseline; gap: 0.5rem; }
  .fr-name { font-family: var(--font-display); font-size: 1.05rem; }
  .fr-ar { font-size: 0.8rem; color: var(--color-ink-muted); direction: rtl; }
  .fr-region { font-size: 0.65rem; color: var(--color-ink-muted); }
  .fr-desc { font-size: 0.72rem; font-weight: 300; color: var(--color-ink-light); }
  .fr-badge { font-size: 0.5rem; font-weight: 600; letter-spacing: 0.08em; padding: 0.1rem 0.35rem; border: 1px solid var(--color-border); color: var(--color-ink-muted); white-space: nowrap; }
  @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; gap: 0.15rem; } }
</style>
